document.addEventListener("DOMContentLoaded",(function(){const STORAGE_KEY="emailBuilderState",defaultState={metrics:[{region:"EMEA",deployed:"0",production:"0",followup:"0",listupdated:"0",landingpage:"0",qualtrics:"0",pathfactory:"0",adhoc:"0"},{region:"LATAM",deployed:"0",production:"0",followup:"0",listupdated:"0",landingpage:"0",qualtrics:"0",pathfactory:"0",adhoc:"0"},{region:"NA",deployed:"0",production:"0",followup:"0",listupdated:"0",landingpage:"0",qualtrics:"0",pathfactory:"0",adhoc:"0"},{region:"GLOBAL",deployed:"0",production:"0",followup:"0",listupdated:"0",landingpage:"0",qualtrics:"0",pathfactory:"0",adhoc:"0"}],deployed:[],production:[],followup:[],headers:{deployed:"Deployed Campaigns",production:"Production Campaigns",followup:"Follow Up Campaigns"},wip_link:"https://omgww-my.sharepoint.com/:x:/r/personal/prabu_ashokan_verticurl_com/_layouts/15/Doc.aspx?sourcedoc=%7BC39A6158-FB39-428E-8CCD-1066976AF914%7D&file=RedHat%20NA%20Huddles%20Tracker%20-%202025.xlsx&action=default&mobileredirect=true&DefaultItemOpen=1&ct=1752660236456&wdOrigin=OFFICECOM-WEB.START.EDGEWORTH&cid=25d5e739-70bb-4ee8-bf9b-932a23d79e25&wdPreviousSessionSrc=HarmonyWeb&wdPreviousSession=7bf3b8dc-94d9-4961-9d8c-81f27fb5a54a&isSPOFile=1&ovuser=761f4b7c-0095-4c72-aa8e-7084b3bba8a6%2Cprabu.perumal%40verticurl.com&clickparams=eyJBcHBOYW1lIjoiVGVhbXMtRGVza3RvcCIsIkFwcFZlcnNpb24iOiI0OS8yNTA2MTIxNjQyNCIsIkhhc0ZlZGVyYXRlZFVzZXIiOmZhbHNlfQ%3D%3D",sections:{deployed:!0,production:!0,followup:!0}};function saveState(){const currentState={metrics:[],deployed:[],production:[],followup:[],headers:{},wip_link:document.querySelector('[data-id="wip_link"] a')?.href||"",sections:{deployed:"none"!==document.getElementById("deployed-campaigns-section").style.display,production:"none"!==document.getElementById("production-campaigns-section").style.display,followup:"none"!==document.getElementById("followup-campaigns-section").style.display}};document.querySelectorAll("#main-metrics-tbody tr").forEach((row=>{currentState.metrics.push({region:row.cells[0].textContent.trim(),deployed:row.cells[1].textContent.trim(),production:row.cells[2].textContent.trim(),followup:row.cells[3].textContent.trim(),listupdated:row.cells[4].textContent.trim(),landingpage:row.cells[5].textContent.trim(),qualtrics:row.cells[6].textContent.trim(),pathfactory:row.cells[7].textContent.trim(),adhoc:row.cells[8].textContent.trim()})})),["deployed","production","followup"].forEach((type=>{currentState.headers[type]=document.querySelector(`[data-id="header_${type}"]`)?.textContent.trim()||defaultState.headers[type],currentState.sections[type]&&document.querySelectorAll(`#${type}-campaigns-tbody tr`).forEach((row=>{currentState[type].push({name:row.cells[0].textContent.trim(),url:row.cells[1].querySelector("a")?.href||""})}))})),localStorage.setItem(STORAGE_KEY,JSON.stringify(currentState))}function loadState(){const savedState=JSON.parse(localStorage.getItem(STORAGE_KEY))||{},state={...defaultState,...savedState,headers:{...defaultState.headers,...savedState.headers||{}},sections:{...defaultState.sections,...savedState.sections||{}}},metricsTbody=document.getElementById("main-metrics-tbody");metricsTbody.innerHTML="",state.metrics.forEach(((d,i)=>{const r=metricsTbody.insertRow(),alt=i%2!=0;r.style.backgroundColor=alt?"#f9f9f9":"#ffffff",Object.entries(d).forEach((([k,v])=>{const c=r.insertCell();c.textContent=v,c.style.cssText=`padding:12px 15px;text-align:left;border-bottom:1px solid #e9f5ed;background-color:${alt?"#f9f9f9":"#ffffff"};color:#333;font-family:'Segoe UI',Arial,sans-serif;`,"region"!==k&&(c.className="editable-cell",c.dataset.id=`metrics_${i}_${k}`)}))})),["deployed","production","followup"].forEach((type=>{const section=document.getElementById(`${type}-campaigns-section`),header=document.querySelector(`[data-id="header_${type}"]`);if(header&&(header.textContent=state.headers[type]),section.style.display=state.sections[type]?"block":"none",state.sections[type]){const tbody=document.getElementById(`${type}-campaigns-tbody`);tbody.innerHTML="",state[type].forEach(((d,i)=>tbody.appendChild(createCampaignRow(type,i,d))))}}));const wipLink=document.querySelector('[data-id="wip_link"] a');wipLink&&(wipLink.href=state.wip_link),function(){attachEditableListeners(),document.getElementById("addDeployedRow").onclick=()=>addRow("deployed"),document.getElementById("deleteDeployedRow").onclick=()=>deleteRow("deployed"),document.getElementById("addProdRow").onclick=()=>addRow("production"),document.getElementById("deleteProdRow").onclick=()=>deleteRow("production"),document.getElementById("addFollowUpRow").onclick=()=>addRow("followup"),document.getElementById("deleteFollowUpRow").onclick=()=>deleteRow("followup"),document.getElementById("removeDeployedSection").onclick=()=>removeSection("deployed"),document.getElementById("removeProdSection").onclick=()=>removeSection("production"),document.getElementById("removeFollowUpSection").onclick=()=>removeSection("followup"),document.getElementById("resetButton").onclick=()=>{confirm("Are you sure? This will reset all content and restore any removed sections.")&&(localStorage.removeItem(STORAGE_KEY),loadState())},document.getElementById("copyButton").onclick=handleManualCopy;["bulk-names","bulk-urls","bulk-category"].forEach((id=>document.getElementById(id).addEventListener("input",validateBulkForm))),document.getElementById("bulk-add-btn").onclick=handleBulkAdd}()}function createCampaignRow(type,index,data={name:"New Campaign",url:"#"}){const row=document.createElement("tr"),isAlt=index%2!=0;return row.style.backgroundColor=isAlt?"#f9f9f9":"#ffffff",row.innerHTML=`<td class="editable-cell" data-id="${type}_${index}_name" style="padding:12px 15px;text-align:left;border-bottom:1px solid #eee;background-color:${isAlt?"#f9f9f9":"#fff"};color:#333;font-family:'Segoe UI',Arial,sans-serif;">${data.name}</td><td class="editable-cell link-cell" data-id="${type}_${index}_url" align="right" style="padding:12px 15px;text-align:right;border-bottom:1px solid #eee;background-color:${isAlt?"#f9f9f9":"#fff"};color:#333;font-family:'Segoe UI',Arial,sans-serif;"><a href="${data.url}" target="_blank" style="color:#0078d4;text-decoration:none;font-weight:500;">Link</a></td>`,row}function attachEditableListeners(){document.querySelectorAll(".editable-cell").forEach((cell=>{cell.replaceWith(cell.cloneNode(!0))})),document.querySelectorAll(".editable-cell").forEach((cell=>{cell.addEventListener("click",(function(e){if(cell.querySelector("input")||"A"===e.target.tagName)return;const isLink=cell.classList.contains("link-cell"),originalHTML=cell.innerHTML,originalValue=isLink?cell.querySelector("a")?.href:cell.textContent.trim();cell.innerHTML="";const input=document.createElement("input");input.type="text",input.value=originalValue,cell.appendChild(input),input.focus();const save=()=>{isLink?(cell.innerHTML=originalHTML,cell.querySelector("a").href=input.value.trim()):cell.textContent=input.value.trim(),saveState()};input.addEventListener("blur",save),input.addEventListener("keydown",(ev=>{"Enter"===ev.key&&save(),"Escape"===ev.key&&(cell.innerHTML=originalHTML)}))}))}))}function addRow(type){const tbody=document.getElementById(`${type}-campaigns-tbody`);tbody.appendChild(createCampaignRow(type,tbody.rows.length)),attachEditableListeners(),saveState()}function deleteRow(type){const tbody=document.getElementById(`${type}-campaigns-tbody`);tbody.rows.length>0?(tbody.deleteRow(-1),saveState()):alert(`No rows to delete in the ${type} section.`)}function removeSection(type){confirm(`Remove the ${type} section?`)&&(document.getElementById(`${type}-campaigns-section`).style.display="none",saveState())}const bulkNamesInput=document.getElementById("bulk-names"),bulkUrlsInput=document.getElementById("bulk-urls"),bulkCategorySelect=document.getElementById("bulk-category"),bulkAddBtn=document.getElementById("bulk-add-btn"),validationMsg=document.getElementById("bulk-validation-msg"),urlRegex=/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/i;function validateBulkForm(){bulkNamesInput.classList.remove("invalid"),bulkUrlsInput.classList.remove("invalid");const names=bulkNamesInput.value.split(/,|\n/).map((s=>s.trim())).filter(Boolean),urls=bulkUrlsInput.value.split(/,|\n/).map((s=>s.trim())).filter(Boolean),category=bulkCategorySelect.value;let msg="",isValid=!0;if(0===names.length&&0===urls.length&&!category)return validationMsg.textContent="",void(bulkAddBtn.disabled=!0);!urls.every((url=>urlRegex.test(url)))&&urls.length>0?(msg="One or more entries in URLS is not a valid URL.",bulkUrlsInput.classList.add("invalid"),isValid=!1):names.length!==urls.length?(msg=`Found ${names.length} names and ${urls.length} URLs. Counts must match.`,isValid=!1):0===names.length?(msg="Campaign Names cannot be empty.",isValid=!1):category?msg=`Ready to add ${names.length} campaign(s).`:(msg="Please select a target section.",isValid=!1),validationMsg.textContent=msg,validationMsg.style.color=isValid?"#28a745":"#dc3545",bulkAddBtn.disabled=!isValid}function handleBulkAdd(){const names=bulkNamesInput.value.split(/,|\n/).map((s=>s.trim())).filter(Boolean),urls=bulkUrlsInput.value.split(/,|\n/).map((s=>s.trim())).filter(Boolean),type=bulkCategorySelect.value;if(!type||names.length!==urls.length||0===names.length)return;const tbody=document.getElementById(`${type}-campaigns-tbody`);names.forEach(((name,i)=>{tbody.appendChild(createCampaignRow(type,tbody.rows.length,{name:name,url:urls[i]}))})),attachEditableListeners(),saveState(),alert(`${names.length} campaign(s) successfully added!`),bulkNamesInput.value="",bulkUrlsInput.value="",bulkCategorySelect.value="",validateBulkForm()}function handleManualCopy(){const reportContainer=document.getElementById("interactive-container");try{const range=document.createRange();range.selectNode(reportContainer),window.getSelection().removeAllRanges(),window.getSelection().addRange(range),document.execCommand("copy"),window.getSelection().removeAllRanges(),alert("The entire report has been copied to your clipboard!\nYou can now paste it into Outlook.")}catch(err){alert("Could not automatically copy the report. Please select it manually (Ctrl+A) and copy."),console.error("Copy failed:",err)}}loadState()}));
