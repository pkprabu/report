<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Daily Performance Overview - Editor</title>
<style type="text/css">
    body {
        width: 100% !important; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%;
        margin: 0; padding: 0; font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f2f5;
    }
    table { border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; }
    a { text-decoration: none; }
    .editable-cell { cursor: pointer; position: relative; }
    td.editable-cell.link-cell, .wip-link-wrapper { padding-right: 40px !important; }
    td.editable-cell { padding-right: 25px !important; }
    .editable-cell:hover::after {
        content: 'âœŽ'; position: absolute; right: 8px; top: 50%;
        transform: translateY(-50%); color: #0078d4; font-weight: bold; opacity: 0.8;
    }
    .editable-cell input {
        width: 95%; padding: 5px; margin: -6px; border: 1px solid #0078d4;
        border-radius: 4px; font-family: 'Segoe UI', Arial, sans-serif; font-size: 14px; box-sizing: border-box;
    }
    .controls-container {
        text-align: center; margin-top: 20px; padding: 20px; background-color: #fff;
        max-width: 600px; margin-left: auto; margin-right: auto; border-radius: 8px;
        border: 1px solid #ddd; margin-bottom: 40px;
    }
    .controls-container h3 { margin-top: 0; color: #333; }
    .button-group { margin-top: 15px; }
    .controls-container button {
        border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;
        font-weight: 600; font-size: 12px; margin: 4px; color: white;
        transition: all 0.2s ease-in-out;
    }
    .controls-container button:hover { opacity: 0.85; transform: translateY(-1px); }
    .btn-add { background-color: #28a745; }
    .btn-delete { background-color: #dc3545; }
    .btn-remove-section { background-color: #6f42c1; }
    #resetButton { background-color: #fd7e14; }
</style>
</head>

<body style="margin: 0; padding: 0; background-color: #f0f2f5;">

<!-- CONTROLS PANEL -->
<div class="controls-container">
    <h3>Content Controls</h3>
    <div class="button-group">
        <button id="addDeployedRow" class="btn-add">Add Deployed Row</button>
        <button id="deleteDeployedRow" class="btn-delete">Delete Deployed Row</button>
        <button id="removeDeployedSection" class="btn-remove-section">Remove Deployed Section</button>
    </div>
    <div class="button-group">
        <button id="addProdRow" class="btn-add">Add Production Row</button>
        <button id="deleteProdRow" class="btn-delete">Delete Production Row</button>
        <button id="removeProdSection" class="btn-remove-section">Remove Production Section</button>
    </div>
    <div class="button-group">
        <button id="addFollowUpRow" class="btn-add">Add Follow-Up Row</button>
        <button id="deleteFollowUpRow" class="btn-delete">Delete Follow-Up Row</button>
        <button id="removeFollowUpSection" class="btn-remove-section">Remove Follow-Up Section</button>
    </div>
    <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
    <button id="resetButton">Reset All Content & Layout</button>
    <span>&nbsp;&nbsp;&nbsp;<a style="color: #ee0000;" href="process-documentation.html" target="_blank">Read the Document</a></span>
</div>

<div id="interactive-container">
    <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tr>
            <td align="center" style="padding: 40px 20px;">
                <!--[if (gte mso 9)|(IE)]><table align="center" border="0" cellspacing="0" cellpadding="0" width="600"><tr><td align="center" valign="top" width="600"><![endif]-->
                <table border="0" cellpadding="0" cellspacing="0" width="600"
                    style="background-color: #ffffff; border: 1px solid #dddddd; border-radius: 8px;">
                    <!-- Header -->
                    <tr>
                        <td align="center" bgcolor="#0078d4"
                            style="background-color: #0078d4; color: #ffffff; padding: 25px 30px; border-top-left-radius: 8px; border-top-right-radius: 8px;">
                            <h1 style="margin: 0; font-size: 28px; font-weight: 700; color: #ffffff; font-family: 'Segoe UI', Arial, sans-serif;">Daily Performance Overview</h1>
                        </td>
                    </tr>
                    <!-- Content Section -->
                    <tr>
                        <td style="padding: 25px 30px 30px 30px;">
                            <div id="main-metrics-section">
                                <table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-top: 20px; margin-bottom: 30px; border: 1px solid #c3e6cb; border-radius: 8px;">
                                    <thead>
                                        <tr>
                                            <th bgcolor="#d4edda" style="background-color: #d4edda; color: #155724; font-weight: 600; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #c3e6cb; font-family: 'Segoe UI', Arial, sans-serif;">Region</th>
                                            <th bgcolor="#d4edda" style="background-color: #d4edda; color: #155724; font-weight: 600; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #c3e6cb; font-family: 'Segoe UI', Arial, sans-serif;">Deployed</th>
                                            <th bgcolor="#d4edda" style="background-color: #d4edda; color: #155724; font-weight: 600; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #c3e6cb; font-family: 'Segoe UI', Arial, sans-serif;">Production</th>
                                            <th bgcolor="#d4edda" style="background-color: #d4edda; color: #155724; font-weight: 600; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #c3e6cb; font-family: 'Segoe UI', Arial, sans-serif;">Follow-Up</th>
                                            <th bgcolor="#d4edda" style="background-color: #d4edda; color: #155724; font-weight: 600; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #c3e6cb; font-family: 'Segoe UI', Arial, sans-serif;">List Updated</th>
                                            <th bgcolor="#d4edda" style="background-color: #d4edda; color: #155724; font-weight: 600; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #c3e6cb; font-family: 'Segoe UI', Arial, sans-serif;">Landing Page</th>
                                            <th bgcolor="#d4edda" style="background-color: #d4edda; color: #155724; font-weight: 600; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #c3e6cb; font-family: 'Segoe UI', Arial, sans-serif;">Qualtrics</th>
                                            <th bgcolor="#d4edda" style="background-color: #d4edda; color: #155724; font-weight: 600; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #c3e6cb; font-family: 'Segoe UI', Arial, sans-serif;">Pathfactory</th>
                                            <th bgcolor="#d4edda" style="background-color: #d4edda; color: #155724; font-weight: 600; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #c3e6cb; font-family: 'Segoe UI', Arial, sans-serif;">Ad Hoc</th>
                                        </tr>
                                    </thead>
                                    <tbody id="main-metrics-tbody">
                                        <!-- This content is now static in the template but editable -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div id="deployed-campaigns-section">
                                <table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-top: 20px; margin-bottom: 30px; border: 1px solid #d0e7ff; border-radius: 8px;">
                                    <thead>
                                        <tr>
                                            <th width="80%" bgcolor="#e6f2ff" style="background-color: #e6f2ff; color: #0056b3; font-weight: 700; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #d0e7ff; font-family: 'Segoe UI', Arial, sans-serif;">Deployed Campaigns</th>
                                            <th width="20%" bgcolor="#e6f2ff" align="right" style="background-color: #e6f2ff; color: #0056b3; font-weight: 700; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: right; border-bottom: 1px solid #d0e7ff; font-family: 'Segoe UI', Arial, sans-serif;">URL'S</th>
                                        </tr>
                                    </thead>
                                    <tbody id="deployed-campaigns-tbody"></tbody>
                                </table>
                            </div>

                            <div id="production-campaigns-section">
                                <table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-top: 20px; margin-bottom: 30px; border: 1px solid #d0e7ff; border-radius: 8px;">
                                    <thead>
                                        <tr>
                                            <th width="80%" bgcolor="#e6f2ff" style="background-color: #e6f2ff; color: #0056b3; font-weight: 700; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #d0e7ff; font-family: 'Segoe UI', Arial, sans-serif;">Production Campaigns</th>
                                            <th width="20%" bgcolor="#e6f2ff" align="right" style="background-color: #e6f2ff; color: #0056b3; font-weight: 700; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: right; border-bottom: 1px solid #d0e7ff; font-family: 'Segoe UI', Arial, sans-serif;">URL'S</th>
                                        </tr>
                                    </thead>
                                    <tbody id="production-campaigns-tbody"></tbody>
                                </table>
                            </div>

                            <div id="followup-campaigns-section">
                                <table border="0" cellpadding="0" cellspacing="0" width="100%" style="margin-top: 20px; margin-bottom: 30px; border: 1px solid #d0e7ff; border-radius: 8px;">
                                    <thead>
                                        <tr>
                                            <th width="80%" bgcolor="#e6f2ff" style="background-color: #e6f2ff; color: #0056b3; font-weight: 700; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: left; border-bottom: 1px solid #d0e7ff; font-family: 'Segoe UI', Arial, sans-serif;">Follow Up Campaigns</th>
                                            <th width="20%" bgcolor="#e6f2ff" align="right" style="background-color: #e6f2ff; color: #0056b3; font-weight: 700; text-transform: uppercase; font-size: 13px; padding: 12px 15px; text-align: right; border-bottom: 1px solid #d0e7ff; font-family: 'Segoe UI', Arial, sans-serif;">URL'S</th>
                                        </tr>
                                    </thead>
                                    <tbody id="followup-campaigns-tbody"></tbody>
                                </table>
                            </div>

                            <p style="margin: 0 0 25px 0; font-size: 15px; line-height: 1.6; color: #333333; font-family: 'Segoe UI', Arial, sans-serif;">
                                <strong style="font-weight: bold;">WIP Link:</strong>
                                <span class="editable-cell link-cell wip-link-wrapper" data-id="wip_link">
                                    <a href="https://docs.google.com/spreadsheets/d/1GTLyTLl7SJDwWB-FeKkUGPErqPFkJn09-T3Szilyzg/edit?pli=1&gid=90158843#gid=90158843"
                                        target="_blank"
                                        style="color: #0078d4; text-decoration: none; font-weight: 500;">View Work In Progress Sheet</a>
                                </span>
                            </p>
                        </td>
                    </tr>
                    <!-- Footer -->
                    <tr>
                        <td bgcolor="#f0f2f5" style="background-color: #f0f2f5; padding: 20px 30px; text-align: center; font-size: 13px; color: #666666; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; border-top: 1px solid #e0e0e0; font-family: 'Segoe UI', Arial, sans-serif;">
                            <p style="margin: 0 0 5px 0;">Thank you,<br />Prabu Perumal</p>
                        </td>
                    </tr>
                </table>
                <!--[if (gte mso 9)|(IE)]></td></tr></table><![endif]-->
            </td>
        </tr>
    </table>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
const STORAGE_KEY = 'emailBuilderState';

// --- DEFAULT STATE ---
const defaultState = {
    metrics: [
        { region: 'EMEA', deployed: '0', production: '0', followup: '0', listupdated: '0', landingpage: '0', qualtrics: '0', pathfactory: '0', adhoc: '0' },
        { region: 'LATAM', deployed: '0', production: '0', followup: '0', listupdated: '0', landingpage: '0', qualtrics: '0', pathfactory: '0', adhoc: '0' },
        { region: 'NA', deployed: '0', production: '0', followup: '0', listupdated: '0', landingpage: '0', qualtrics: '0', pathfactory: '0', adhoc: '0' },
        { region: 'GLOBAL', deployed: '0', production: '0', followup: '0', listupdated: '0', landingpage: '0', qualtrics: '0', pathfactory: '0', adhoc: '0' }
    ],
    deployed: [
        { name: 'Program Name', url: 'https://projects.zoho.in/portal/verticurlprojects#zp/projects/65749000088965489/tasks/custom-view/65749000065240003/list/task-detail/65749000091172229?group_by=tasklist' },
        { name: 'Program Name', url: 'https://projects.zoho.in/portal/veriziprojects/task-detail/657490000098548983' },
        { name: 'Program Name', url: 'https://projects.zoho.in/portal/veriziprojects/task-detail/657490000098548983' },
        { name: 'Program Name', url: 'https://projects.zoho.in/portal/veriziprojects/task-detail/657490000098548983' }
    ],
    production: [
        { name: 'Program Name', url: 'https://projects.zoho.in/portal/veriziprojects/task-detail/657490000094331161' },
        { name: 'Program Name', url: 'https://projects.zoho.in/portal/veriziprojects/task-detail/657490000094331161' }
    ],
    followup: [
        { name: 'Program Name', url: 'https://projects.zoho.in/portal/veriziprojects/collaboration/feed/task-detail/657490000098943394' }
    ],
    wip_link: 'https://docs.google.com/spreadsheets/d/1GTLyTLI7SJDwWB-FeKkUGPErqfPFkJn09-T3S2iIzyg/edit?pli=1&gid=90158843#gid=90158843',
    sections: {
        deployed: true,
        production: true,
        followup: true
    }
};

// --- CORE FUNCTIONS ---
function saveState() {
    const currentState = {
        metrics: [],
        deployed: [],
        production: [],
        followup: [],
        wip_link: document.querySelector('[data-id="wip_link"] a')?.href || '',
        sections: {
            deployed: !!document.getElementById('deployed-campaigns-section'),
            production: !!document.getElementById('production-campaigns-section'),
            followup: !!document.getElementById('followup-campaigns-section')
        }
    };

    // Save metrics table
    document.querySelectorAll('#main-metrics-tbody tr').forEach(row => {
        currentState.metrics.push({
            region: row.cells[0].textContent.trim(),
            deployed: row.cells[1].textContent.trim(),
            production: row.cells[2].textContent.trim(),
            followup: row.cells[3].textContent.trim(),
            listupdated: row.cells[4].textContent.trim(),
            landingpage: row.cells[5].textContent.trim(),
            qualtrics: row.cells[6].textContent.trim(),
            pathfactory: row.cells[7].textContent.trim(),
            adhoc: row.cells[8].textContent.trim()
        });
    });

    // Save campaign tables
    ['deployed', 'production', 'followup'].forEach(type => {
        if (currentState.sections[type]) {
            document.querySelectorAll(`#${type}-campaigns-tbody tr`).forEach(row => {
                currentState[type].push({
                    name: row.cells[0].textContent.trim(),
                    url: row.cells[1].querySelector('a')?.href || ''
                });
            });
        }
    });

    localStorage.setItem(STORAGE_KEY, JSON.stringify(currentState));
}

function loadState() {
    const savedState = JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultState;
    
    // Build metrics table
    const metricsTbody = document.getElementById('main-metrics-tbody');
    metricsTbody.innerHTML = '';
    savedState.metrics.forEach((rowData, i) => {
        const row = metricsTbody.insertRow();
        const isAlt = i % 2 !== 0;
        row.style.backgroundColor = isAlt ? '#f9f9f9' : '#ffffff';
        Object.entries(rowData).forEach(([key, value], cellIndex) => {
            const cell = row.insertCell();
            cell.textContent = value;
            cell.style.cssText = `padding: 12px 15px; text-align: left; border-bottom: 1px solid #e9f5ed; background-color: ${isAlt ? '#f9f9f9' : '#ffffff'}; color: #333333; font-family: 'Segoe UI', Arial, sans-serif;`;
            if (key !== 'region') {
                cell.className = 'editable-cell';
                cell.dataset.id = `metrics_${i}_${key}`;
            }
        });
    });

    // Build campaign tables
    ['deployed', 'production', 'followup'].forEach(type => {
        const section = document.getElementById(`${type}-campaigns-section`);
        if (savedState.sections[type]) {
            section.style.display = 'block';
            const tbody = document.getElementById(`${type}-campaigns-tbody`);
            tbody.innerHTML = '';
            savedState[type].forEach((rowData, i) => {
                tbody.appendChild(createCampaignRow(type, i, rowData));
            });
        } else {
            section.style.display = 'none';
        }
    });

    // Load WIP link
    const wipLink = document.querySelector('[data-id="wip_link"] a');
    if (wipLink) wipLink.href = savedState.wip_link;

    attachAllListeners();
}

function createCampaignRow(type, index, data = { name: 'Program Name', url: '#' }) {
    const row = document.createElement('tr');
    const isAlt = index % 2 !== 0;
    row.style.backgroundColor = isAlt ? '#f9f9f9' : '#ffffff';

    row.innerHTML = `
        <td class="editable-cell" data-id="${type}_${index}_name" style="padding: 12px 15px; text-align: left; border-bottom: 1px solid #eeeeee; background-color: ${isAlt ? '#f9f9f9' : '#ffffff'}; color: #333333; font-family: 'Segoe UI', Arial, sans-serif;">${data.name}</td>
        <td class="editable-cell link-cell" data-id="${type}_${index}_url" align="right" style="padding: 12px 15px; text-align: right; border-bottom: 1px solid #eeeeee; background-color: ${isAlt ? '#f9f9f9' : '#ffffff'}; color: #333333; font-family: 'Segoe UI', Arial, sans-serif;"><a href="${data.url}" target="_blank" style="color: #0078d4; text-decoration: none; font-weight: 500;">Link</a></td>
    `;
    return row;
}

function attachEditableListeners() {
    document.querySelectorAll('.editable-cell').forEach(cell => {
        // Remove old listener to prevent duplicates
        cell.replaceWith(cell.cloneNode(true));
    });
    document.querySelectorAll('.editable-cell').forEach(cell => {
        cell.addEventListener('click', function handler(e) {
            if (cell.querySelector('input') || e.target.tagName === 'A') return;

            const key = cell.dataset.id;
            const isLinkCell = cell.classList.contains('link-cell');
            const originalContent = cell.innerHTML;
            const linkElement = cell.querySelector('a');
            const originalValue = isLinkCell && linkElement ? linkElement.href : cell.textContent.trim();
            
            cell.innerHTML = '';
            const input = document.createElement('input');
            input.type = 'text';
            input.value = originalValue;
            cell.appendChild(input);
            input.focus();

            const saveChanges = () => {
                const newValue = input.value.trim();
                if (isLinkCell) {
                    cell.innerHTML = originalContent;
                    const newLink = cell.querySelector('a');
                    if (newLink) newLink.href = newValue;
                } else {
                    cell.textContent = newValue;
                }
                saveState();
            };

            input.addEventListener('blur', saveChanges);
            input.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') saveChanges();
                if (event.key === 'Escape') {
                    cell.innerHTML = originalContent;
                }
            });
        });
    });
}

function attachAllListeners() {
    attachEditableListeners();
    // Row buttons
    document.getElementById('addDeployedRow').onclick = () => addRow('deployed');
    document.getElementById('deleteDeployedRow').onclick = () => deleteRow('deployed');
    document.getElementById('addProdRow').onclick = () => addRow('production');
    document.getElementById('deleteProdRow').onclick = () => deleteRow('production');
    document.getElementById('addFollowUpRow').onclick = () => addRow('followup');
    document.getElementById('deleteFollowUpRow').onclick = () => deleteRow('followup');
    // Section buttons
    document.getElementById('removeDeployedSection').onclick = () => removeSection('deployed');
    document.getElementById('removeProdSection').onclick = () => removeSection('production');
    document.getElementById('removeFollowUpSection').onclick = () => removeSection('followup');
    // Reset button
    document.getElementById('resetButton').onclick = () => {
        if (confirm('Are you sure? This will reset all content and restore any removed sections.')) {
            localStorage.removeItem(STORAGE_KEY);
            loadState();
        }
    };
}

// --- DYNAMIC ACTIONS ---
function addRow(type) {
    const tbody = document.getElementById(`${type}-campaigns-tbody`);
    const newIndex = tbody.rows.length;
    const newRow = createCampaignRow(type, newIndex);
    tbody.appendChild(newRow);
    attachEditableListeners();
    saveState();
}

function deleteRow(type) {
    const tbody = document.getElementById(`${type}-campaigns-tbody`);
    if (tbody.rows.length > 0) {
        tbody.deleteRow(tbody.rows.length - 1);
        saveState();
    } else {
        alert(`There are no rows to delete in the ${type} section.`);
    }
}

function removeSection(type) {
    if (confirm(`Are you sure you want to permanently remove the ${type} campaigns section?`)) {
        const section = document.getElementById(`${type}-campaigns-section`);
        if (section) {
            section.style.display = 'none';
            saveState();
        }
    }
}

// --- INITIALIZATION ---
loadState();
});
</script>

</body>
</html>
